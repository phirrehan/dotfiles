#!/bin/bash

# Get pdf name
pdfname=$(
  curl -sk https://lahore.comsats.edu.pk/student/time-table.aspx |
    grep -oP 'href="\K[0-9]{8}-[0-9]{4}-classes\.pdf' || {
    echo "pdfname search failed :("
    exit 1
  }
)
url="https://lahore.comsats.edu.pk/student/$pdfname"

# Get pdf through curl
curl -k -o full_timetable.pdf "$url" || {
  echo ":( Download failed! Try again."
  exit 2
}

# Get page number
page=$(pdfgrep -n -i 'sp25-bse-a' 'full_timetable.pdf' | cut -d: -f1 | sort -u)

# extract the page from pdf
pdftk 'full_timetable.pdf' cat "$page" output 'timetable.pdf' && rm 'full_timetable.pdf'

# move the timetable.pdf file to a convenient location
mv timetable.pdf ~/Downloads/
